#!/bin/bash

if [[ "$#" -ne 2 ]]; then
  echo "👹 Oops! Missing source and distribution paths! Please do $0 <source_path> <distribution_path>"
  exit 1
fi

src_dir="$1"
dist_dir="$2"

if [[ ! -d "$src_dir" ]] || [[ ! -d "$dist_dir" ]]; then
  echo "👹 Oops! The provided paths are not valid!"
  exit 1
fi

src_content_dir="$src_dir/content"
if [[ ! -d "$src_content_dir" ]]; then
  echo "👹 Oops! Missing the 'content' in the source directory..."
  exit 1
fi

find "$src_content_dir" -type f -name "*.mp4" | while read -r src_file; do
  dist_file="${src_file/src\/content/dist}"
  dist_file_dirname=$(dirname "$dist_file")
  if [[ ! -d "$dist_file_dirname" ]]; then
    echo "👹 Oops! The distribution directory $dist_file_dirname doesn't exist. Run the script after the astro build command, please!"
    echo "-> $dist_file_dirname"
    exit 1
  fi

  if ! cp "$src_file" "$dist_file"; then
    echo "❌ Failed to copy $src_file to $dist_file"
  else
    echo "✅ Copied $src_file to $dist_file"
  fi
done

echo "👍 Done! Copied the content video files successfully."
